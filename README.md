# web_package
Ruby implementation of Signed HTTP Exchange format, allowing a browser to trust that a HTTP request-response pair was generated by the origin it claims.


## Saving the Internet on a flash? - Easily-peasily

Let's sign a pair of request/response and serve the bundle as `application/signed-exchange` - Chromium browsers understand what it means and unpack them smoothly.

For that we need a certificate with a special "CanSignHttpExchanges" extension, but we will use just a self-signed one, so to show off. Please refer [here](https://github.com/WICG/webpackage/tree/master/go/signedexchange#creating-our-first-signed-exchange) to create such.

Also we need an `https` cdn serving static certificate in `application/cert-chain+cbor` format. We can use `gen-certurl` tool from [here](https://github.com/WICG/webpackage/tree/master/go/signedexchange#creating-our-first-signed-exchange) to convert PEM certificate into such a thing.

Having done the above we can assign required env vars:
```bash
export SXG_CERT_URL='https://my-cdn.com/cert.cbor' \
       SXG_CERT_PATH='/local/path/to/cert.pem' \
       SXG_PRIV_PATH='/local/path/to/priv.key'
```

And all the fun begins:
```ruby
  require 'web_package'

  # mimicking `Rack::Response` class
  Response = Struct.new(:body, :headers, :status)

  # this is the request/response pair
  request  = 'https://foo.com/bar'
  response = Response['<h1>Hello world!</h1>', {}, 200]

  exchange = WebPackage::SignedHttpExchange.new(request, response)

  exchange.headers
  # => {"Content-Type"=>"application/signed-exchange;v=b3", "Cache-Control"=>"no-transform", "X-Content-Type-Options"=>"nosniff"}

  exchange.body
  # => "sxg1-b3\x00\x00\x13https://foo.com/bar\x00\x015\x00\x00\x8Clabel;cert-sha256=*+DoXYlCX+bFRyW65R3bFA2ICIz8Tyu54MLFUFo5tziA=*;cert-url=\"https://my-cdn.com/cert.cbor\";date=1556744158;expires=1557348958;integrity=\"digest/mi-sha256-03\";sig=*MEQCIGdIGAQtUT6xWDzVBcdmd05J46ctDgxhg7GRN0R4R0SaAiBRRfE+Yp76k2tJZQCRBfoIf9SMAAJj/uktw2SMYUa6qQ==*;validity-url=\"https://foo.com/bar\"\xA4FdigestX9mi-sha256-03=4QeUScOpSoJl7KJ47F11rSDHUTHZhDVwLiSLOWMcvqg=G:statusC200Pcontent-encodingLmi-sha256-03Vx-content-type-optionsGnosniff\x00\x00\x00\x00\x00\x00@\x00<h1>Hello world!</h1>"
```

Save the headers and a body into a file and we are done! âœ…

Internet is in our file (or on a flash).

Now start any http server to spit this file and see "Hello world!" HTML with a `https://foo.com/bar` in a browser's address bar!

<!-- TODO: add image here -->
<img href="">

<!-- TODO: Write about running Chrome in a special mode to disable certificate checks -->


<!-- TODO: Add contributions section -->
<!-- TODO: Add authors section -->
<!-- TODO: Add LICENSE authors section -->
